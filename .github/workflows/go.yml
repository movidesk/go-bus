name: Go
on: [push]
jobs:

  build:
    name: Build
    runs-on: ubuntu-latest
    services:
      postgres:
        image: rabbitmq:3-management
        env:
          RABBITMQ_DEFAULT_USER: "guest"
          RABBITMQ_DEFAULT_PASS: "guest"
          RABBITMQ_DEFAULT_VHOST: "/"
        ports:
          - 5672:5672
          - 15672:15672
        options: '--health-cmd "rabbitmqctl status" --health-interval 10s --health-timeout 10s --health-retries 6 --health-start-period 60s'
   
    steps:

    - name: Set up Go 1.13
      uses: actions/setup-go@v1
      with:
        go-version: 1.13
      id: go

    - name: Check out code into the Go module directory
      uses: actions/checkout@v2

    - name: ufw status
      run: sudo ufw status

    - name: ufw disable
      run: sudo ufw disable

    - name: ufw status again
      run: sudo ufw status


    - name: Deps
      run: go get -v -t -d ./...

    - name: Unit
      run: go test -v -run Unit ./...
      
    - name: Integration
      run: sudo go test -v -run Integration ./...
